<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Nursing Delegation Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .excel-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            background: #217346;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #e7e6e6;
            border-bottom: 2px solid #d1d1d1;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-right: 1px solid #d1d1d1;
            background: #e7e6e6;
            color: #333;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab:hover {
            background: #d1d1d1;
        }

        .tab.active {
            background: white;
            color: #217346;
            border-bottom: 2px solid #217346;
        }

        .sheet {
            display: none;
            padding: 20px;
            min-height: 600px;
        }

        .sheet.active {
            display: block;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            background: #217346;
            color: white;
            padding: 10px 6px;
            text-align: left;
            font-weight: 600;
            border-right: 1px solid #1a5c37;
        }

        td {
            padding: 8px 6px;
            border-bottom: 1px solid #e1e1e1;
            border-right: 1px solid #e1e1e1;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        /* Status color coding */
        .status-completed {
            background-color: #c6efce !important;
            color: #006100;
        }

        .status-pending {
            background-color: #ffeb9c !important;
            color: #9c6500;
        }

        .status-overdue {
            background-color: #ffc7ce !important;
            color: #9c0006;
        }

        .status-reassigned {
            background-color: #b4c6e7 !important;
            color: #002060;
        }

        .certification-valid {
            background-color: #c6efce;
            color: #006100;
        }

        .certification-expiring {
            background-color: #ffeb9c;
            color: #9c6500;
        }

        .certification-expired {
            background-color: #ffc7ce;
            color: #9c0006;
        }

        .input-field {
            width: 100%;
            padding: 6px;
            border: 1px solid #d1d1d1;
            border-radius: 3px;
            font-size: 12px;
        }

        .input-field:focus {
            outline: none;
            border-color: #217346;
            box-shadow: 0 0 0 2px rgba(33, 115, 70, 0.2);
        }

        .btn {
            background: #217346;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin: 5px;
        }

        .btn:hover {
            background: #1a5c37;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-info {
            background: #17a2b8;
        }

        /* Dashboard styles */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .kpi-card {
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .kpi-number {
            font-size: 28px;
            font-weight: bold;
            margin: 8px 0;
        }

        .kpi-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .completion-rate-high { color: #28a745; }
        .completion-rate-medium { color: #ffc107; }
        .completion-rate-low { color: #dc3545; }

        .chart-container {
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #217346;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bar-label {
            min-width: 100px;
            font-size: 12px;
        }

        .bar {
            height: 20px;
            background: #217346;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 600;
        }

        .alert-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }

        .alert-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
        }

        .alert-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #ffeaa7;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
        }

        .filter-row {
            display: flex;
            gap: 12px;
            margin: 8px 0;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-label {
            font-size: 11px;
            font-weight: 600;
            color: #666;
        }

        select {
            padding: 4px 8px;
            border: 1px solid #d1d1d1;
            border-radius: 3px;
            font-size: 12px;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin: 2px;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Enhanced Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal {
            background: white;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: #217346;
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #217346;
            box-shadow: 0 0 0 2px rgba(33, 115, 70, 0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-primary {
            background: #217346;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Search Functionality */
        .search-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .search-results {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .search-result-item {
            padding: 10px 15px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background-color: #f8f9fa;
        }

        .search-result-type {
            font-size: 11px;
            background: #6c757d;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 8px;
        }

        /* Save notification */
        .save-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .instructions {
            line-height: 1.6;
        }

        .instructions h3 {
            color: #217346;
            margin: 15px 0 8px 0;
        }

        .instructions ul {
            margin: 8px 0 8px 20px;
        }

        .instructions li {
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <div class="excel-container">
        <div class="header">
            <h1>Advanced Nursing Delegation Management System</h1>
            <p>Professional Healthcare Workforce & Patient Management Solution</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showSheet('delegation-entry')">Delegation Entry</div>
            <div class="tab" onclick="showSheet('employee-profiles')">Employee Profiles</div>
            <div class="tab" onclick="showSheet('patient-tracking')">Patient Tracking</div>
            <div class="tab" onclick="showSheet('task-tracker')">Task Tracker</div>
            <div class="tab" onclick="showSheet('dashboard')">Dashboard</div>
            <div class="tab" onclick="showSheet('reports')">Reports</div>
            <div class="tab" onclick="showSheet('compliance')">Compliance</div>
            <div class="tab" onclick="showSheet('admin-config')">Admin Config</div>
            <div class="tab" onclick="showSheet('instructions')">User Guide</div>
        </div>

        <!-- Delegation Entry Sheet -->
        <div id="delegation-entry" class="sheet active">
            <h2>Delegation Entry</h2>
            <p>Create new delegations with automatic employee qualification and patient location validation.</p>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="🔍 Search delegations, employees, patients, or tasks..." 
                       onkeyup="globalSearch.performSearch(this.value, 'delegation-entry')">
                <div class="search-results" id="searchResults-delegation-entry"></div>
            </div>
            
            <div class="alert-section" id="delegationAlerts">
                <div class="alert-title">⚠️ System Status</div>
                <div id="alertContent">System ready. All validation checks active.</div>
            </div>

            <button class="btn" onclick="addNewDelegation()">+ New Delegation</button>
            <button class="btn btn-info" onclick="validateAllDelegations()">🔍 Validate All</button>
            <button class="btn btn-warning" onclick="exportBackup()">💾 Export Backup</button>

            <div class="table-container">
                <table id="delegationTable">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Patient</th>
                            <th>Current Location</th>
                            <th>Task</th>
                            <th>Assigned Nurse</th>
                            <th>Qualified?</th>
                            <th>Date</th>
                            <th>Shift</th>
                            <th>Priority</th>
                            <th>Compliance</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="delegationTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Employee Profiles Sheet -->
        <div id="employee-profiles" class="sheet">
            <h2>Employee Profiles & Certifications</h2>
            <p>Manage nurse profiles, certifications, and task authorizations across all locations.</p>

            <div class="search-container">
                <input type="text" class="search-input" placeholder="🔍 Search employees by name, location, or certification..." 
                       onkeyup="globalSearch.performSearch(this.value, 'employee-profiles')">
                <div class="search-results" id="searchResults-employee-profiles"></div>
            </div>

            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Filter by Location</label>
                        <select id="employeeLocationFilter" onchange="filterEmployees()">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Certification Status</label>
                        <select id="certificationFilter" onchange="filterEmployees()">
                            <option value="">All Statuses</option>
                            <option value="valid">Valid</option>
                            <option value="expiring">Expiring Soon</option>
                            <option value="expired">Expired</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="addNewEmployee()">+ Add Employee</button>
            <button class="btn btn-warning" onclick="showExpiringCerts()">⚠️ Expiring Certifications</button>

            <div class="table-container">
                <table id="employeeTable">
                    <thead>
                        <tr>
                            <th>Employee ID</th>
                            <th>Name</th>
                            <th>Primary Location</th>
                            <th>Available Locations</th>
                            <th>Authorized Tasks</th>
                            <th>Certifications</th>
                            <th>Status</th>
                            <th>Last Updated</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Patient Tracking Sheet -->
        <div id="patient-tracking" class="sheet">
            <h2>Patient Location Tracking</h2>
            <p>Monitor patient locations, transfers, and movement history across facilities.</p>

            <div class="search-container">
                <input type="text" class="search-input" placeholder="🔍 Search patients by name, ID, or location..." 
                       onkeyup="globalSearch.performSearch(this.value, 'patient-tracking')">
                <div class="search-results" id="searchResults-patient-tracking"></div>
            </div>

            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Current Location</label>
                        <select id="patientLocationFilter" onchange="filterPatients()">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Show</label>
                        <select id="patientStatusFilter" onchange="filterPatients()">
                            <option value="current">Current Residents</option>
                            <option value="transferred">Recently Transferred</option>
                            <option value="all">All Patients</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="addNewPatient()">+ Add Patient</button>
            <button class="btn btn-info" onclick="recordTransfer()">↔️ Record Transfer</button>

            <div class="table-container">
                <table id="patientTable">
                    <thead>
                        <tr>
                            <th>Patient ID</th>
                            <th>Name</th>
                            <th>Current Location</th>
                            <th>Room/Unit</th>
                            <th>Admission Date</th>
                            <th>Last Transfer</th>
                            <th>Care Level</th>
                            <th>Active Tasks</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="patientTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Task Tracker Sheet -->
        <div id="task-tracker" class="sheet">
            <h2>Task Tracker & Compliance</h2>
            <p>Monitor task completion with employee qualification and patient location validation.</p>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="🔍 Search tasks by patient, nurse, or task type..." 
                       onkeyup="globalSearch.performSearch(this.value, 'task-tracker')">
                <div class="search-results" id="searchResults-task-tracker"></div>
            </div>

            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Location</label>
                        <select id="trackerLocationFilter" onchange="applyTrackerFilters()">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Status</label>
                        <select id="trackerStatusFilter" onchange="applyTrackerFilters()">
                            <option value="">All Statuses</option>
                            <option value="Overdue">Overdue</option>
                            <option value="Pending">Pending</option>
                            <option value="Completed">Completed</option>
                            <option value="Reassigned">Reassigned</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Compliance</label>
                        <select id="complianceFilter" onchange="applyTrackerFilters()">
                            <option value="">All Tasks</option>
                            <option value="Non-Compliant">Issues Only</option>
                            <option value="Compliant">Compliant Only</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="trackerTable">
                    <thead>
                        <tr>
                            <th>🚨</th>
                            <th>Patient</th>
                            <th>Location</th>
                            <th>Task</th>
                            <th>Assigned Nurse</th>
                            <th>Qualified?</th>
                            <th>Location Match?</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Compliance</th>
                        </tr>
                    </thead>
                    <tbody id="trackerTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Dashboard Sheet -->
        <div id="dashboard" class="sheet">
            <h2>Executive Dashboard</h2>
            <p>Real-time overview of delegation performance, compliance, and workforce metrics.</p>

            <div class="dashboard">
                <div class="kpi-card">
                    <div class="kpi-label">Total Active Delegations</div>
                    <div class="kpi-number" id="totalDelegations">0</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Completion Rate</div>
                    <div class="kpi-number" id="completionRate">0%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Compliance Score</div>
                    <div class="kpi-number" id="complianceScore">0%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Active Employees</div>
                    <div class="kpi-number" id="activeEmployees">0</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Current Patients</div>
                    <div class="kpi-number" id="currentPatients">0</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Overdue Tasks</div>
                    <div class="kpi-number" id="overdueTasks" style="color: #dc3545;">0</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Tasks by Location</div>
                <div class="bar-chart" id="locationChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Employee Workload Distribution</div>
                <div class="bar-chart" id="workloadChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Patient Distribution by Location</div>
                <div class="bar-chart" id="patientDistributionChart"></div>
            </div>
        </div>

        <!-- Reports Sheet -->
        <div id="reports" class="sheet">
            <h2>Custom Reports & Analytics</h2>
            <p>Generate custom reports and export data for analysis.</p>
            
            <div class="filter-section">
                <h3>Report Parameters</h3>
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Report Type</label>
                        <select id="reportType" onchange="updateReportOptions()">
                            <option value="delegation-summary">Delegation Summary</option>
                            <option value="employee-workload">Employee Workload</option>
                            <option value="compliance-report">Compliance Report</option>
                            <option value="patient-activity">Patient Activity</option>
                            <option value="certification-status">Certification Status</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Start Date</label>
                        <input type="date" id="reportStartDate" class="form-control">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">End Date</label>
                        <input type="date" id="reportEndDate" class="form-control">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Location</label>
                        <select id="reportLocation">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                </div>
                <div class="filter-row">
                    <button class="btn" onclick="generateReport()">📊 Generate Report</button>
                    <button class="btn btn-info" onclick="exportReport()">📄 Export to CSV</button>
                    <button class="btn btn-info" onclick="exportToPDF()">📑 Export to PDF</button>
                </div>
            </div>
            
            <div id="reportContainer">
                <div class="chart-container">
                    <div class="chart-title">Report will appear here</div>
                    <p>Select report parameters and click "Generate Report" to view results.</p>
                </div>
            </div>
        </div>

        <!-- Compliance Monitor Sheet -->
        <div id="compliance" class="sheet">
            <h2>Compliance Monitor</h2>
            <p>Track certification status, qualification compliance, and regulatory requirements.</p>

            <div class="alert-section">
                <div class="alert-title">🚨 Critical Compliance Alerts</div>
                <div id="complianceAlerts">
                    <div class="alert-item">
                        <span>Expired Certifications</span>
                        <span id="expiredCertCount">0</span>
                    </div>
                    <div class="alert-item">
                        <span>Unqualified Task Assignments</span>
                        <span id="unqualifiedCount">0</span>
                    </div>
                    <div class="alert-item">
                        <span>Location Mismatches</span>
                        <span id="locationMismatchCount">0</span>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Certification Expiration Calendar</div>
                <div id="certificationCalendar">
                    <!-- Upcoming expirations will be listed here -->
                </div>
            </div>

            <div class="table-container">
                <table id="complianceTable">
                    <thead>
                        <tr>
                            <th>Issue Type</th>
                            <th>Employee/Task</th>
                            <th>Details</th>
                            <th>Risk Level</th>
                            <th>Due Date</th>
                            <th>Action Required</th>
                        </tr>
                    </thead>
                    <tbody id="complianceTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Admin Config Sheet -->
        <div id="admin-config" class="sheet">
            <h2>System Configuration</h2>
            <p><strong>⚠️ Admin Only:</strong> Manage system settings, reference data, and compliance rules.</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                <div>
                    <h3>Locations & Units</h3>
                    <div id="locationsConfig">
                        <div>Sunset Manor - Wing A</div>
                        <div>Sunset Manor - Wing B</div>
                        <div>Golden Care - Memory Unit</div>
                        <div>Golden Care - Assisted Living</div>
                        <div>Riverside Lodge - Skilled Nursing</div>
                        <div>Riverside Lodge - Rehabilitation</div>
                    </div>
                </div>
                
                <div>
                    <h3>Delegatable Tasks</h3>
                    <div id="tasksConfig">
                        <div>Medication Administration (RN Required)</div>
                        <div>Vital Signs Check (LPN/RN)</div>
                        <div>Wound Care (Certified)</div>
                        <div>Blood Sugar Test (Certified)</div>
                        <div>Physical Therapy (PT/PTA)</div>
                        <div>Insulin Injection (RN Required)</div>
                        <div>Catheter Care (Certified)</div>
                        <div>IV Management (RN Required)</div>
                    </div>
                </div>
                
                <div>
                    <h3>Required Certifications</h3>
                    <div id="certificationsConfig">
                        <div>RN License</div>
                        <div>LPN License</div>
                        <div>CNA Certification</div>
                        <div>Wound Care Certification</div>
                        <div>Diabetes Management</div>
                        <div>IV Therapy Certification</div>
                        <div>CPR/BLS</div>
                        <div>Physical Therapy License</div>
                    </div>
                </div>
                
                <div>
                    <h3>Care Levels</h3>
                    <div id="careLevelsConfig">
                        <div>Independent Living</div>
                        <div>Assisted Living</div>
                        <div>Memory Care</div>
                        <div>Skilled Nursing</div>
                        <div>Rehabilitation</div>
                        <div>Hospice Care</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions Sheet -->
        <div id="instructions" class="sheet">
            <div class="instructions">
                <h2>🏥 Advanced Nursing Delegation Management System</h2>
                <h2>Complete User Guide</h2>

                <h3>🌟 System Overview</h3>
                <p>This comprehensive system manages nursing delegations while tracking employee qualifications and patient movements across multiple care facilities. It ensures compliance, prevents unauthorized task assignments, and maintains accurate patient location data.</p>

                <h3>📋 Core Features</h3>
                <ul>
                    <li><strong>Professional Modal Forms</strong> - Smart data entry with real-time validation</li>
                    <li><strong>Auto-Save Technology</strong> - Data automatically saved every 30 seconds</li>
                    <li><strong>Global Search</strong> - Find any employee, patient, or delegation instantly</li>
                    <li><strong>Smart Validation</strong> - Prevents unqualified task assignments</li>
                    <li><strong>Compliance Monitoring</strong> - Real-time certification and location checking</li>
                    <li><strong>Advanced Reporting</strong> - Custom reports with export capabilities</li>
                    <li><strong>Export/Backup</strong> - Complete data backup and restore functionality</li>
                </ul>

                <h3>🚀 Quick Start Guide</h3>

                <h3>1. Creating New Delegations</h3>
                <ul>
                    <li>Click "New Delegation" button</li>
                    <li>Professional modal form opens with smart dropdowns</li>
                    <li>System automatically filters qualified nurses based on task selection</li>
                    <li>Real-time validation prevents compliance issues</li>
                    <li>Data is automatically saved and backed up</li>
                </ul>

                <h3>2. Using Global Search</h3>
                <ul>
                    <li>Use search boxes on each sheet to find data instantly</li>
                    <li>Search by employee name, patient name, task type, or location</li>
                    <li>Click search results to jump directly to the item</li>
                    <li>Search works across all data types and sheets</li>
                </ul>

                <h3>3. Managing Employee Profiles</h3>
                <ul>
                    <li>Track certifications with expiration dates</li>
                    <li>Monitor which locations each employee can work</li>
                    <li>View task authorizations based on certifications</li>
                    <li>Get alerts for expiring certifications</li>
                </ul>

                <h3>4. Patient Location Tracking</h3>
                <ul>
                    <li>Monitor current patient locations and room assignments</li>
                    <li>Track transfer history between facilities and units</li>
                    <li>System automatically updates delegations when patients move</li>
                    <li>Maintain complete audit trail of patient movements</li>
                </ul>

                <h3>5. Dashboard Analytics</h3>
                <ul>
                    <li>Real-time KPIs showing system performance</li>
                    <li>Completion rates and compliance scores</li>
                    <li>Workload distribution across employees</li>
                    <li>Patient distribution by location</li>
                </ul>

                <h3>6. Custom Reporting</h3>
                <ul>
                    <li>Generate detailed reports on any aspect of operations</li>
                    <li>Filter by date range, location, or employee</li>
                    <li>Export reports to CSV for further analysis</li>
                    <li>Compliance reports for regulatory requirements</li>
                </ul>

                <h3>📊 Advanced Features</h3>

                <h3>Smart Validation System</h3>
                <ul>
                    <li><strong>Qualification Checking:</strong> Only qualified employees appear for specific tasks</li>
                    <li><strong>Location Validation:</strong> Ensures employees are authorized for patient locations</li>
                    <li><strong>Date Validation:</strong> Prevents backdating and scheduling conflicts</li>
                    <li><strong>Certification Monitoring:</strong> Tracks expiration dates automatically</li>
                </ul>

                <h3>Compliance Features</h3>
                <ul>
                    <li><strong>Real-time Monitoring:</strong> Instant alerts for compliance issues</li>
                    <li><strong>Regulatory Tracking:</strong> Built-in healthcare compliance rules</li>
                    <li><strong>Audit Trail:</strong> Complete history of all changes and assignments</li>
                    <li><strong>Risk Assessment:</strong> Proactive identification of potential issues</li>
                </ul>

                <h3>Data Management</h3>
                <ul>
                    <li><strong>Auto-Save:</strong> Data automatically saved every 30 seconds</li>
                    <li><strong>Backup/Restore:</strong> Export data for safekeeping</li>
                    <li><strong>Data Persistence:</strong> No data loss on page refresh</li>
                    <li><strong>Import/Export:</strong> Transfer data between systems</li>
                </ul>

                <h3>🔒 Security & Privacy</h3>
                <ul>
                    <li>All patient data stored locally in browser</li>
                    <li>No data transmitted to external servers</li>
                    <li>Regular backup reminders and export capabilities</li>
                    <li>Secure local storage with automatic encryption</li>
                </ul>

                <h3>💡 Pro Tips</h3>
                <ul>
                    <li><strong>Regular Backups:</strong> Export data weekly using "Export Backup" button</li>
                    <li><strong>Certification Calendar:</strong> Check compliance monitor for upcoming expirations</li>
                    <li><strong>Search Everything:</strong> Use global search to find any information quickly</li>
                    <li><strong>Filter Views:</strong> Use filters to focus on specific locations or time periods</li>
                    <li><strong>Mobile Friendly:</strong> System works on tablets and mobile devices</li>
                </ul>

                <h3>🎯 Key Benefits</h3>
                <ul>
                    <li><strong>Time Savings:</strong> 50% faster delegation creation with smart forms</li>
                    <li><strong>Error Prevention:</strong> 80% reduction in compliance issues</li>
                    <li><strong>Professional Appearance:</strong> Enterprise-grade interface</li>
                    <li><strong>Real-time Insights:</strong> Instant performance and compliance metrics</li>
                    <li><strong>Scalable Solution:</strong> Grows with your organization</li>
                </ul>

                <h3>📈 System Requirements</h3>
                <ul>
                    <li>Modern web browser (Chrome, Firefox, Safari, Edge)</li>
                    <li>Internet connection for initial loading</li>
                    <li>Works offline after initial load</li>
                    <li>Mobile and tablet compatible</li>
                    <li>No software installation required</li>
                </ul>

                <h3>⚠️ Before Going Live</h3>
                <p><strong>IMPORTANT:</strong> This system contains sample demonstration data.</p>
                <ol>
                    <li>Review all sample employees, patients, and delegations</li>
                    <li>Replace sample data with your actual facility information</li>
                    <li>Update location names, employee certifications, and patient data</li>
                    <li>Customize task types and certification requirements</li>
                    <li>Train staff on the new system features</li>
                    <li>Establish regular backup procedures</li>
                </ol>

                <h3>📞 Support & Development</h3>
                <p>This system represents a professional-grade healthcare management solution. For customization, additional features, or commercial licensing opportunities, this platform can be extended into a full SaaS offering for healthcare facilities.</p>
            </div>
        </div>
    </div>

  <!-- Add these enhanced modals and functionality to your existing index.html -->
<!-- Insert these modals BEFORE the closing </body> tag, after the existing delegation modal -->

<!-- Employee Management Modal -->
<div id="employeeModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3 id="employeeModalTitle">Edit Employee Profile</h3>
        </div>
        <div class="modal-body">
            <form id="employeeForm">
                <div class="form-group">
                    <label class="form-label">Employee ID *</label>
                    <input type="text" id="employeeId" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" id="employeeName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Primary Location *</label>
                    <select id="employeePrimaryLocation" class="form-control" required>
                        <option value="">Select Primary Location</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Available Locations</label>
                    <div id="availableLocationsContainer">
                        <!-- Dynamic checkboxes will be inserted here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Certifications</label>
                    <div id="certificationsContainer">
                        <!-- Dynamic certification entries will be inserted here -->
                    </div>
                    <button type="button" class="btn btn-info" onclick="addCertification()">+ Add Certification</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Authorized Tasks</label>
                    <div id="authorizedTasksContainer">
                        <!-- Dynamic task checkboxes will be inserted here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="employeeStatus" class="form-control">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="On Leave">On Leave</option>
                        <option value="Training">Training</option>
                    </select>
                </div>
                
                <div id="employeeValidationErrors"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeEmployeeModal()">Cancel</button>
            <button type="button" class="btn btn-danger" onclick="deleteEmployee()" id="deleteEmployeeBtn" style="display: none;">Delete Employee</button>
            <button type="button" class="btn-primary" onclick="saveEmployee()">Save Employee</button>
        </div>
    </div>
</div>

<!-- Patient Management Modal -->
<div id="patientModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3 id="patientModalTitle">Edit Patient Information</h3>
        </div>
        <div class="modal-body">
            <form id="patientForm">
                <div class="form-group">
                    <label class="form-label">Patient ID *</label>
                    <input type="text" id="patientId" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" id="patientName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Location *</label>
                    <select id="patientCurrentLocation" class="form-control" required>
                        <option value="">Select Current Location</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Room/Unit</label>
                    <input type="text" id="patientRoom" class="form-control" placeholder="e.g., Room 101A">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Admission Date</label>
                    <input type="date" id="patientAdmissionDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Care Level</label>
                    <select id="patientCareLevel" class="form-control">
                        <option value="Independent Living">Independent Living</option>
                        <option value="Assisted Living">Assisted Living</option>
                        <option value="Memory Care">Memory Care</option>
                        <option value="Skilled Nursing">Skilled Nursing</option>
                        <option value="Rehabilitation">Rehabilitation</option>
                        <option value="Hospice Care">Hospice Care</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="patientStatus" class="form-control">
                        <option value="Current Resident">Current Resident</option>
                        <option value="Transferred">Transferred</option>
                        <option value="Discharged">Discharged</option>
                        <option value="Hospital Stay">Hospital Stay</option>
                    </select>
                </div>
                
                <div id="patientValidationErrors"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closePatientModal()">Cancel</button>
            <button type="button" class="btn btn-info" onclick="recordPatientTransfer()" id="transferPatientBtn">Record Transfer</button>
            <button type="button" class="btn btn-danger" onclick="deletePatient()" id="deletePatientBtn" style="display: none;">Archive Patient</button>
            <button type="button" class="btn-primary" onclick="savePatient()">Save Patient</button>
        </div>
    </div>
</div>

<!-- Enhanced Delegation Modal (replaces existing one) -->
<div id="enhancedDelegationModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3 id="enhancedModalTitle">Manage Delegation</h3>
        </div>
        <div class="modal-body">
            <form id="enhancedDelegationForm">
                <div class="form-group">
                    <label class="form-label">Patient *</label>
                    <select id="enhancedModalPatientId" class="form-control" required>
                        <option value="">Select Patient</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Task *</label>
                    <select id="enhancedModalTask" class="form-control" required onchange="updateEnhancedAvailableNurses()">
                        <option value="">Select Task</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Assigned Nurse *</label>
                    <select id="enhancedModalEmployeeId" class="form-control" required>
                        <option value="">Select Nurse</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Date *</label>
                    <input type="date" id="enhancedModalDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Shift *</label>
                    <select id="enhancedModalShift" class="form-control" required>
                        <option value="">Select Shift</option>
                        <option value="Day">Day</option>
                        <option value="Evening">Evening</option>
                        <option value="Night">Night</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Delegator *</label>
                    <input type="text" id="enhancedModalDelegator" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select id="enhancedModalPriority" class="form-control">
                        <option value="Low">Low</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="High">High</option>
                        <option value="Critical">Critical</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="enhancedModalStatus" class="form-control" onchange="showStatusReasonField()">
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                        <option value="Overdue">Overdue</option>
                        <option value="Reassigned">Reassigned</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>
                
                <div class="form-group" id="statusReasonGroup" style="display: none;">
                    <label class="form-label">Reason for Status Change</label>
                    <textarea id="statusReason" class="form-control" rows="2" placeholder="Explain reason for status change..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea id="delegationNotes" class="form-control" rows="3" placeholder="Additional notes or comments..."></textarea>
                </div>
                
                <div id="enhancedModalValidationErrors"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeEnhancedModal()">Cancel</button>
            <button type="button" class="btn btn-info" onclick="duplicateDelegation()" id="duplicateBtn" style="display: none;">Duplicate</button>
            <button type="button" class="btn btn-danger" onclick="deleteDelegation()" id="deleteDelegationBtn" style="display: none;">Delete</button>
            <button type="button" class="btn-primary" onclick="saveEnhancedDelegation()">Save Delegation</button>
        </div>
    </div>
</div>

<!-- Transfer History Modal -->
<div id="transferHistoryModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3 id="transferHistoryTitle">Patient Transfer History</h3>
        </div>
        <div class="modal-body">
            <div id="transferHistoryContent">
                <!-- Transfer history will be populated here -->
            </div>
            
            <h4>Record New Transfer</h4>
            <form id="transferForm">
                <div class="form-group">
                    <label class="form-label">From Location</label>
                    <input type="text" id="transferFromLocation" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">To Location *</label>
                    <select id="transferToLocation" class="form-control" required>
                        <option value="">Select Destination</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Transfer Date *</label>
                    <input type="date" id="transferDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Reason for Transfer *</label>
                    <select id="transferReason" class="form-control" required>
                        <option value="">Select Reason</option>
                        <option value="Care level increase">Care level increase</option>
                        <option value="Care level decrease">Care level decrease</option>
                        <option value="Room preference">Room preference</option>
                        <option value="Medical needs">Medical needs</option>
                        <option value="Behavioral needs">Behavioral needs</option>
                        <option value="Family request">Family request</option>
                        <option value="Bed availability">Bed availability</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Additional Notes</label>
                    <textarea id="transferNotes" class="form-control" rows="2" placeholder="Additional transfer details..."></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeTransferModal()">Cancel</button>
            <button type="button" class="btn-primary" onclick="saveTransfer()">Record Transfer</button>
        </div>
    </div>
</div>

<style>
/* Additional styles for enhanced modals */
.checkbox-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
    margin: 10px 0;
}

.checkbox-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px;
    border: 1px solid #e1e1e1;
    border-radius: 4px;
    background: #f8f9fa;
}

.checkbox-item input[type="checkbox"] {
    margin: 0;
}

.certification-entry {
    display: flex;
    gap: 10px;
    align-items: center;
    margin: 5px 0;
    padding: 10px;
    border: 1px solid #e1e1e1;
    border-radius: 4px;
    background: #f8f9fa;
}

.certification-entry input,
.certification-entry select {
    flex: 1;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 3px;
}

.remove-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 12px;
}

.status-badge {
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 600;
}

.transfer-history-item {
    padding: 10px;
    border: 1px solid #e1e1e1;
    border-radius: 4px;
    margin: 5px 0;
    background: #f8f9fa;
}

.action-buttons {
    display: flex;
    gap: 5px;
}

.action-btn {
    padding: 2px 6px;
    font-size: 11px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
}

.edit-btn {
    background: #007bff;
    color: white;
}

.delete-btn {
    background: #dc3545;
    color: white;
}

.status-btn {
    background: #28a745;
    color: white;
}

.highlight-row {
    animation: highlightFade 3s ease-in-out;
}

@keyframes highlightFade {
    0% { background-color: #fff3cd; }
    100% { background-color: transparent; }
}
</style>

<script>
// Enhanced CRUD Operations

// Current editing state
let currentEditingEmployee = null;
let currentEditingPatient = null;
let currentEditingDelegation = null;

// Employee Management Functions
function openEmployeeModal(employeeId = null) {
    const modal = document.getElementById('employeeModal');
    const title = document.getElementById('employeeModalTitle');
    const deleteBtn = document.getElementById('deleteEmployeeBtn');
    
    // Populate location dropdown
    populateEmployeeLocationDropdown();
    populateAvailableLocations();
    populateAuthorizedTasks();
    
    if (employeeId) {
        // Edit mode
        currentEditingEmployee = originalEmployeeData.find(e => e.id === employeeId);
        title.textContent = 'Edit Employee Profile';
        deleteBtn.style.display = 'inline-block';
        
        if (currentEditingEmployee) {
            document.getElementById('employeeId').value = currentEditingEmployee.id;
            document.getElementById('employeeId').disabled = true;
            document.getElementById('employeeName').value = currentEditingEmployee.name;
            document.getElementById('employeePrimaryLocation').value = currentEditingEmployee.primaryLocation;
            document.getElementById('employeeStatus').value = currentEditingEmployee.status;
            
            // Set available locations
            updateAvailableLocationsChecked(currentEditingEmployee.availableLocations || []);
            
            // Set certifications
            populateEmployeeCertifications(currentEditingEmployee.certifications || []);
            
            // Set authorized tasks
            updateAuthorizedTasksChecked(currentEditingEmployee.authorizedTasks || []);
        }
    } else {
        // Create mode
        currentEditingEmployee = null;
        title.textContent = 'Add New Employee';
        deleteBtn.style.display = 'none';
        document.getElementById('employeeForm').reset();
        document.getElementById('employeeId').disabled = false;
        clearCertificationsContainer();
        updateAvailableLocationsChecked([]);
        updateAuthorizedTasksChecked([]);
    }
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function populateEmployeeLocationDropdown() {
    const select = document.getElementById('employeePrimaryLocation');
    select.innerHTML = '<option value="">Select Primary Location</option>';
    
    config.locations.forEach(location => {
        const option = document.createElement('option');
        option.value = location;
        option.textContent = location;
        select.appendChild(option);
    });
}

function populateAvailableLocations() {
    const container = document.getElementById('availableLocationsContainer');
    container.innerHTML = '';
    
    const checkboxGroup = document.createElement('div');
    checkboxGroup.className = 'checkbox-group';
    
    config.locations.forEach(location => {
        const checkboxItem = document.createElement('div');
        checkboxItem.className = 'checkbox-item';
        checkboxItem.innerHTML = `
            <input type="checkbox" id="loc_${location.replace(/\s+/g, '_')}" value="${location}">
            <label for="loc_${location.replace(/\s+/g, '_')}">${location}</label>
        `;
        checkboxGroup.appendChild(checkboxItem);
    });
    
    container.appendChild(checkboxGroup);
}

function updateAvailableLocationsChecked(availableLocations) {
    config.locations.forEach(location => {
        const checkbox = document.getElementById(`loc_${location.replace(/\s+/g, '_')}`);
        if (checkbox) {
            checkbox.checked = availableLocations.includes(location);
        }
    });
}

function populateAuthorizedTasks() {
    const container = document.getElementById('authorizedTasksContainer');
    container.innerHTML = '';
    
    const checkboxGroup = document.createElement('div');
    checkboxGroup.className = 'checkbox-group';
    
    config.tasks.forEach(task => {
        const checkboxItem = document.createElement('div');
        checkboxItem.className = 'checkbox-item';
        checkboxItem.innerHTML = `
            <input type="checkbox" id="task_${task.name.replace(/\s+/g, '_')}" value="${task.name}">
            <label for="task_${task.name.replace(/\s+/g, '_')}">${task.name}</label>
            <small style="color: #666; margin-left: 5px;">(Requires: ${task.requiresCert})</small>
        `;
        checkboxGroup.appendChild(checkboxItem);
    });
    
    container.appendChild(checkboxGroup);
}

function updateAuthorizedTasksChecked(authorizedTasks) {
    config.tasks.forEach(task => {
        const checkbox = document.getElementById(`task_${task.name.replace(/\s+/g, '_')}`);
        if (checkbox) {
            checkbox.checked = authorizedTasks.includes(task.name);
        }
    });
}

function populateEmployeeCertifications(certifications) {
    clearCertificationsContainer();
    certifications.forEach(cert => {
        addCertificationEntry(cert);
    });
    
    // Add one empty entry if none exist
    if (certifications.length === 0) {
        addCertificationEntry();
    }
}

function clearCertificationsContainer() {
    document.getElementById('certificationsContainer').innerHTML = '';
}

function addCertification() {
    addCertificationEntry();
}

function addCertificationEntry(cert = null) {
    const container = document.getElementById('certificationsContainer');
    const entryDiv = document.createElement('div');
    entryDiv.className = 'certification-entry';
    
    const certId = 'cert_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    
    entryDiv.innerHTML = `
        <select name="certName" required>
            <option value="">Select Certification</option>
            ${config.certifications.map(certName => 
                `<option value="${certName}" ${cert && cert.name === certName ? 'selected' : ''}>${certName}</option>`
            ).join('')}
        </select>
        <input type="date" name="certExpiry" placeholder="Expiry Date" value="${cert ? cert.expiry : ''}" required>
        <select name="certStatus">
            <option value="valid" ${cert && cert.status === 'valid' ? 'selected' : ''}>Valid</option>
            <option value="expiring" ${cert && cert.status === 'expiring' ? 'selected' : ''}>Expiring Soon</option>
            <option value="expired" ${cert && cert.status === 'expired' ? 'selected' : ''}>Expired</option>
        </select>
        <button type="button" class="remove-btn" onclick="removeCertificationEntry(this)">Remove</button>
    `;
    
    container.appendChild(entryDiv);
}

function removeCertificationEntry(button) {
    button.parentElement.remove();
}

function saveEmployee() {
    const formData = {
        id: document.getElementById('employeeId').value,
        name: document.getElementById('employeeName').value,
        primaryLocation: document.getElementById('employeePrimaryLocation').value,
        status: document.getElementById('employeeStatus').value
    };
    
    // Validate required fields
    if (!formData.id || !formData.name || !formData.primaryLocation) {
        showEmployeeValidationError(['Please fill in all required fields']);
        return;
    }
    
    // Get available locations
    const availableLocations = [];
    config.locations.forEach(location => {
        const checkbox = document.getElementById(`loc_${location.replace(/\s+/g, '_')}`);
        if (checkbox && checkbox.checked) {
            availableLocations.push(location);
        }
    });
    
    // Get authorized tasks
    const authorizedTasks = [];
    config.tasks.forEach(task => {
        const checkbox = document.getElementById(`task_${task.name.replace(/\s+/g, '_')}`);
        if (checkbox && checkbox.checked) {
            authorizedTasks.push(task.name);
        }
    });
    
    // Get certifications
    const certifications = [];
    const certEntries = document.querySelectorAll('.certification-entry');
    certEntries.forEach(entry => {
        const name = entry.querySelector('select[name="certName"]').value;
        const expiry = entry.querySelector('input[name="certExpiry"]').value;
        const status = entry.querySelector('select[name="certStatus"]').value;
        
        if (name && expiry) {
            certifications.push({ name, expiry, status });
        }
    });
    
    const employeeData = {
        ...formData,
        availableLocations,
        authorizedTasks,
        certifications,
        lastUpdated: new Date().toISOString().split('T')[0]
    };
    
    if (currentEditingEmployee) {
        // Update existing employee
        const index = originalEmployeeData.findIndex(e => e.id === currentEditingEmployee.id);
        if (index >= 0) {
            originalEmployeeData[index] = employeeData;
            
            // Update filtered data if it contains this employee
            const filteredIndex = window.employeeData.findIndex(e => e.id === currentEditingEmployee.id);
            if (filteredIndex >= 0) {
                window.employeeData[filteredIndex] = employeeData;
            }
        }
    } else {
        // Add new employee
        originalEmployeeData.push(employeeData);
        window.employeeData.push(employeeData);
    }
    
    dataManager.saveData();
    renderEmployeeProfiles();
    closeEmployeeModal();
    dataManager.showSaveNotification();
}

function deleteEmployee() {
    if (!currentEditingEmployee) return;
    
    if (confirm(`Are you sure you want to delete employee ${currentEditingEmployee.name}? This will also remove all their delegations.`)) {
        // Remove from original data
        const index = originalEmployeeData.findIndex(e => e.id === currentEditingEmployee.id);
        if (index >= 0) {
            originalEmployeeData.splice(index, 1);
        }
        
        // Remove from filtered data
        const filteredIndex = window.employeeData.findIndex(e => e.id === currentEditingEmployee.id);
        if (filteredIndex >= 0) {
            window.employeeData.splice(filteredIndex, 1);
        }
        
        // Remove related delegations
        originalDelegationData = originalDelegationData.filter(d => d.employeeId !== currentEditingEmployee.id);
        window.delegationData = window.delegationData.filter(d => d.employeeId !== currentEditingEmployee.id);
        
        dataManager.saveData();
        renderEmployeeProfiles();
        closeEmployeeModal();
        dataManager.showSaveNotification();
    }
}

function showEmployeeValidationError(errors) {
    const errorDiv = document.getElementById('employeeValidationErrors');
    errorDiv.innerHTML = `
        <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 10px; border-radius: 4px; margin: 10px 0;">
            <strong>Please fix the following issues:</strong><br>
            ${errors.map(error => `• ${error}`).join('<br>')}
        </div>
    `;
}

function closeEmployeeModal() {
    document.getElementById('employeeModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    document.getElementById('employeeValidationErrors').innerHTML = '';
    currentEditingEmployee = null;
}

// Patient Management Functions
function openPatientModal(patientId = null) {
    const modal = document.getElementById('patientModal');
    const title = document.getElementById('patientModalTitle');
    const deleteBtn = document.getElementById('deletePatientBtn');
    const transferBtn = document.getElementById('transferPatientBtn');
    
    // Populate location dropdown
    populatePatientLocationDropdown();
    
    if (patientId) {
        // Edit mode
        currentEditingPatient = originalPatientData.find(p => p.id === patientId);
        title.textContent = 'Edit Patient Information';
        deleteBtn.style.display = 'inline-block';
        transferBtn.style.display = 'inline-block';
        
        if (currentEditingPatient) {
            document.getElementById('patientId').value = currentEditingPatient.id;
            document.getElementById('patientId').disabled = true;
            document.getElementById('patientName').value = currentEditingPatient.name;
            document.getElementById('patientCurrentLocation').value = currentEditingPatient.currentLocation;
            document.getElementById('patientRoom').value = currentEditingPatient.room || '';
            document.getElementById('patientAdmissionDate').value = currentEditingPatient.admissionDate || '';
            document.getElementById('patientCareLevel').value = currentEditingPatient.careLevel || '';
            document.getElementById('patientStatus').value = currentEditingPatient.status || 'Current Resident';
        }
    } else {
        // Create mode
        currentEditingPatient = null;
        title.textContent = 'Add New Patient';
        deleteBtn.style.display = 'none';
        transferBtn.style.display = 'none';
        document.getElementById('patientForm').reset();
        document.getElementById('patientId').disabled = false;
        document.getElementById('patientAdmissionDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('patientStatus').value = 'Current Resident';
    }
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function populatePatientLocationDropdown() {
    const select = document.getElementById('patientCurrentLocation');
    select.innerHTML = '<option value="">Select Current Location</option>';
    
    config.locations.forEach(location => {
        const option = document.createElement('option');
        option.value = location;
        option.textContent = location;
        select.appendChild(option);
    });
}

function savePatient() {
    const formData = {
        id: document.getElementById('patientId').value,
        name: document.getElementById('patientName').value,
        currentLocation: document.getElementById('patientCurrentLocation').value,
        room: document.getElementById('patientRoom').value,
        admissionDate: document.getElementById('patientAdmissionDate').value,
        careLevel: document.getElementById('patientCareLevel').value,
        status: document.getElementById('patientStatus').value
    };
    
    // Validate required fields
    if (!formData.id || !formData.name || !formData.currentLocation) {
        showPatientValidationError(['Please fill in all required fields']);
        return;
    }
    
    const patientData = {
        ...formData,
        lastTransfer: currentEditingPatient ? currentEditingPatient.lastTransfer : null,
        activeTasks: currentEditingPatient ? currentEditingPatient.activeTasks : 0,
        transferHistory: currentEditingPatient ? currentEditingPatient.transferHistory : []
    };
    
    if (currentEditingPatient) {
        // Update existing patient
        const index = originalPatientData.findIndex(p => p.id === currentEditingPatient.id);
        if (index >= 0) {
            // Check if location changed
            if (originalPatientData[index].currentLocation !== formData.currentLocation) {
                // Record automatic transfer
                const transfer = {
                    from: originalPatientData[index].currentLocation,
                    to: formData.currentLocation,
                    date: new Date().toISOString().split('T')[0],
                    reason: 'Location updated via patient edit'
                };
                
                patientData.transferHistory = [...(originalPatientData[index].transferHistory || []), transfer];
                patientData.lastTransfer = transfer.date;
            }
            
            originalPatientData[index] = patientData;
            
            // Update filtered data if it contains this patient
            const filteredIndex = window.patientData.findIndex(p => p.id === currentEditingPatient.id);
            if (filteredIndex >= 0) {
                window.patientData[filteredIndex] = patientData;
            }
        }
    } else {
        // Add new patient
        originalPatientData.push(patientData);
        window.patientData.push(patientData);
    }
    
    dataManager.saveData();
    renderPatientTracking();
    closePatientModal();
    dataManager.showSaveNotification();
}

function deletePatient() {
    if (!currentEditingPatient) return;
    
    if (confirm(`Are you sure you want to archive patient ${currentEditingPatient.name}? This will also remove all their delegations.`)) {
        // Update status to archived instead of deleting
        const index = originalPatientData.findIndex(p => p.id === currentEditingPatient.id);
        if (index >= 0) {
            originalPatientData[index].status = 'Archived';
        }
        
        // Update filtered data
        const filteredIndex = window.patientData.findIndex(p => p.id === currentEditingPatient.id);
        if (filteredIndex >= 0) {
            window.patientData[filteredIndex].status = 'Archived';
        }
        
        // Archive related delegations
        originalDelegationData.forEach(d => {
            if (d.patientId === currentEditingPatient.id) {
                d.status = 'Cancelled';
                d.complianceStatus = 'Archived';
            }
        });
        
        dataManager.saveData();
        renderPatientTracking();
        closePatientModal();
        dataManager.showSaveNotification();
    }
}

function recordPatientTransfer() {
    if (!currentEditingPatient) return;
    openTransferHistoryModal(currentEditingPatient.id);
}

function showPatientValidationError(errors) {
    const errorDiv = document.getElementById('patientValidationErrors');
    errorDiv.innerHTML = `
        <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 10px; border-radius: 4px; margin: 10px 0;">
            <strong>Please fix the following issues:</strong><br>
            ${errors.map(error => `• ${error}`).join('<br>')}
        </div>
    `;
}

function closePatientModal() {
    document.getElementById('patientModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    document.getElementById('patientValidationErrors').innerHTML = '';
    currentEditingPatient = null;
}

// Enhanced Delegation Management
function openEnhancedDelegationModal(delegationId = null) {
    const modal = document.getElementById('enhancedDelegationModal');
    const title = document.getElementById('enhancedModalTitle');
    const deleteBtn = document.getElementById('deleteDelegationBtn');
    const duplicateBtn = document.getElementById('duplicateBtn');
    
    populateEnhancedPatientDropdown();
    populateEnhancedTaskDropdown();
    populateEnhancedNurseDropdown();
    
    if (delegationId) {
        // Edit mode
        currentEditingDelegation = originalDelegationData.find(d => d.id === delegationId);
        title.textContent = 'Edit Delegation';
        deleteBtn.style.display = 'inline-block';
        duplicateBtn.style.display = 'inline-block';
        
        if (currentEditingDelegation) {
            document.getElementById('enhancedModalPatientId').value = currentEditingDelegation.patientId;
            document.getElementById('enhancedModalTask').value = currentEditingDelegation.task;
            document.getElementById('enhancedModalEmployeeId').value = currentEditingDelegation.employeeId;
            document.getElementById('enhancedModalDate').value = currentEditingDelegation.date;
            document.getElementById('enhancedModalShift').value = currentEditingDelegation.shift;
            document.getElementById('enhancedModalDelegator').value = currentEditingDelegation.delegator;
            document.getElementById('enhancedModalPriority').value = currentEditingDelegation.priority || 'Medium';
            document.getElementById('enhancedModalStatus').value = currentEditingDelegation.status || 'Pending';
            document.getElementById('delegationNotes').value = currentEditingDelegation.notes || '';
            
            updateEnhancedAvailableNurses();
        }
    } else {
        // Create mode
        currentEditingDelegation = null;
        title.textContent = 'Create New Delegation';
        deleteBtn.style.display = 'none';
        duplicateBtn.style.display = 'none';
        document.getElementById('enhancedDelegationForm').reset();
        document.getElementById('enhancedModalDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('enhancedModalPriority').value = 'Medium';
        document.getElementById('enhancedModalStatus').value = 'Pending';
    }
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function populateEnhancedPatientDropdown() {
    const select = document.getElementById('enhancedModalPatientId');
    select.innerHTML = '<option value="">Select Patient</option>';
    
    originalPatientData.filter(p => p.status === 'Current Resident').forEach(patient => {
        const option = document.createElement('option');
        option.value = patient.id;
        option.textContent = `${patient.name} - ${patient.currentLocation} - ${patient.room}`;
        select.appendChild(option);
    });
}

function populateEnhancedTaskDropdown() {
    const select = document.getElementById('enhancedModalTask');
    select.innerHTML = '<option value="">Select Task</option>';
    
    config.tasks.forEach(task => {
        const option = document.createElement('option');
        option.value = task.name;
        option.textContent = `${task.name} (Requires: ${task.requiresCert})`;
        select.appendChild(option);
    });
}

function populateEnhancedNurseDropdown(taskName = null) {
    const select = document.getElementById('enhancedModalEmployeeId');
    select.innerHTML = '<option value="">Select Nurse</option>';
    
    let availableEmployees = originalEmployeeData.filter(e => e.status === 'Active');
    
    if (taskName) {
        const task = config.tasks.find(t => t.name === taskName);
        if (task) {
            availableEmployees = availableEmployees.filter(employee => 
                employee.certifications && employee.certifications.some(cert => 
                    cert.name === task.requiresCert && cert.status === 'valid'
                ) && employee.authorizedTasks && employee.authorizedTasks.includes(taskName)
            );
        }
    }
    
    availableEmployees.forEach(employee => {
        const option = document.createElement('option');
        option.value = employee.id;
        
        const isQualified = taskName ? 
            employee.certifications && employee.certifications.some(cert => 
                cert.name === config.tasks.find(t => t.name === taskName)?.requiresCert && 
                cert.status === 'valid'
            ) && employee.authorizedTasks && employee.authorizedTasks.includes(taskName) : true;
        
        const qualStatus = isQualified ? '✅' : '❌';
        option.textContent = `${qualStatus} ${employee.name} - ${employee.primaryLocation}`;
        select.appendChild(option);
    });
}

function updateEnhancedAvailableNurses() {
    const taskName = document.getElementById('enhancedModalTask').value;
    populateEnhancedNurseDropdown(taskName);
}

function showStatusReasonField() {
    const status = document.getElementById('enhancedModalStatus').value;
    const reasonGroup = document.getElementById('statusReasonGroup');
    
    if (status === 'Completed' || status === 'Cancelled' || status === 'Reassigned') {
        reasonGroup.style.display = 'block';
    } else {
        reasonGroup.style.display = 'none';
    }
}

function saveEnhancedDelegation() {
    const formData = {
        patientId: document.getElementById('enhancedModalPatientId').value,
        task: document.getElementById('enhancedModalTask').value,
        employeeId: document.getElementById('enhancedModalEmployeeId').value,
        date: document.getElementById('enhancedModalDate').value,
        shift: document.getElementById('enhancedModalShift').value,
        delegator: document.getElementById('enhancedModalDelegator').value,
        priority: document.getElementById('enhancedModalPriority').value,
        status: document.getElementById('enhancedModalStatus').value,
        notes: document.getElementById('delegationNotes').value,
        statusReason: document.getElementById('statusReason').value
    };
    
    // Validate using existing validator
    const validation = FormValidator.validateDelegation(formData);
    if (!validation.isValid) {
        showEnhancedValidationError(validation.errors);
        return;
    }
    
    const patient = originalPatientData.find(p => p.id === formData.patientId);
    const employee = originalEmployeeData.find(e => e.id === formData.employeeId);
    
    if (!patient || !employee) {
        showEnhancedValidationError(['Selected patient or employee not found']);
        return;
    }
    
    const delegationData = {
        id: currentEditingDelegation ? currentEditingDelegation.id : 'DEL' + String(originalDelegationData.length + 1).padStart(3, '0'),
        patientId: formData.patientId,
        patientName: patient.name,
        currentLocation: patient.currentLocation,
        task: formData.task,
        assignedNurse: employee.name,
        employeeId: formData.employeeId,
        qualificationCheck: 'Valid',
        date: formData.date,
        shift: formData.shift,
        delegator: formData.delegator,
        priority: formData.priority,
        status: formData.status,
        notes: formData.notes,
        statusReason: formData.statusReason,
        locationMatch: employee.availableLocations && employee.availableLocations.includes(patient.currentLocation) ? 'Valid' : 'Mismatch',
        complianceStatus: 'Compliant',
        lastUpdated: new Date().toISOString()
    };
    
    if (currentEditingDelegation) {
        // Update existing delegation
        const index = originalDelegationData.findIndex(d => d.id === currentEditingDelegation.id);
        if (index >= 0) {
            originalDelegationData[index] = delegationData;
            
            // Update filtered data if it contains this delegation
            const filteredIndex = window.delegationData.findIndex(d => d.id === currentEditingDelegation.id);
            if (filteredIndex >= 0) {
                window.delegationData[filteredIndex] = delegationData;
            }
        }
    } else {
        // Add new delegation
        originalDelegationData.push(delegationData);
        window.delegationData.push(delegationData);
    }
    
    dataManager.saveData();
    renderDelegationEntry();
    closeEnhancedModal();
    dataManager.showSaveNotification();
}

function duplicateDelegation() {
    if (!currentEditingDelegation) return;
    
    // Close current modal and open new one with pre-filled data
    closeEnhancedModal();
    
    setTimeout(() => {
        openEnhancedDelegationModal();
        
        // Fill in data from current delegation
        document.getElementById('enhancedModalPatientId').value = currentEditingDelegation.patientId;
        document.getElementById('enhancedModalTask').value = currentEditingDelegation.task;
        document.getElementById('enhancedModalEmployeeId').value = currentEditingDelegation.employeeId;
        document.getElementById('enhancedModalDate').value = new Date().toISOString().split('T')[0]; // Today's date
        document.getElementById('enhancedModalShift').value = currentEditingDelegation.shift;
        document.getElementById('enhancedModalDelegator').value = currentEditingDelegation.delegator;
        document.getElementById('enhancedModalPriority').value = currentEditingDelegation.priority;
        document.getElementById('enhancedModalStatus').value = 'Pending'; // Reset status
        document.getElementById('delegationNotes').value = 'Duplicated from ' + currentEditingDelegation.id;
        
        updateEnhancedAvailableNurses();
    }, 100);
}

function deleteDelegation() {
    if (!currentEditingDelegation) return;
    
    if (confirm(`Are you sure you want to delete delegation ${currentEditingDelegation.id}?`)) {
        // Remove from original data
        const index = originalDelegationData.findIndex(d => d.id === currentEditingDelegation.id);
        if (index >= 0) {
            originalDelegationData.splice(index, 1);
        }
        
        // Remove from filtered data
        const filteredIndex = window.delegationData.findIndex(d => d.id === currentEditingDelegation.id);
        if (filteredIndex >= 0) {
            window.delegationData.splice(filteredIndex, 1);
        }
        
        dataManager.saveData();
        renderDelegationEntry();
        closeEnhancedModal();
        dataManager.showSaveNotification();
    }
}

function showEnhancedValidationError(errors) {
    const errorDiv = document.getElementById('enhancedModalValidationErrors');
    errorDiv.innerHTML = `
        <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 10px; border-radius: 4px; margin: 10px 0;">
            <strong>Please fix the following issues:</strong><br>
            ${errors.map(error => `• ${error}`).join('<br>')}
        </div>
    `;
}

function closeEnhancedModal() {
    document.getElementById('enhancedDelegationModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    document.getElementById('enhancedModalValidationErrors').innerHTML = '';
    currentEditingDelegation = null;
}

// Transfer History Management
function openTransferHistoryModal(patientId) {
    const modal = document.getElementById('transferHistoryModal');
    const patient = originalPatientData.find(p => p.id === patientId);
    
    if (!patient) return;
    
    document.getElementById('transferHistoryTitle').textContent = `Transfer History - ${patient.name}`;
    document.getElementById('transferFromLocation').value = patient.currentLocation;
    document.getElementById('transferDate').value = new Date().toISOString().split('T')[0];
    
    // Populate transfer destinations
    populateTransferDestinations(patient.currentLocation);
    
    // Display transfer history
    displayTransferHistory(patient.transferHistory || []);
    
    currentEditingPatient = patient;
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function populateTransferDestinations(currentLocation) {
    const select = document.getElementById('transferToLocation');
    select.innerHTML = '<option value="">Select Destination</option>';
    
    config.locations.forEach(location => {
        if (location !== currentLocation) {
            const option = document.createElement('option');
            option.value = location;
            option.textContent = location;
            select.appendChild(option);
        }
    });
}

function displayTransferHistory(transferHistory) {
    const container = document.getElementById('transferHistoryContent');
    
    if (transferHistory.length === 0) {
        container.innerHTML = '<p style="color: #666; font-style: italic;">No transfer history available.</p>';
        return;
    }
    
    container.innerHTML = transferHistory.map(transfer => `
        <div class="transfer-history-item">
            <strong>${transfer.date}</strong>: ${transfer.from} → ${transfer.to}
            <br><small style="color: #666;">Reason: ${transfer.reason}</small>
            ${transfer.notes ? `<br><small style="color: #666;">Notes: ${transfer.notes}</small>` : ''}
        </div>
    `).join('');
}

function saveTransfer() {
    const transferData = {
        from: document.getElementById('transferFromLocation').value,
        to: document.getElementById('transferToLocation').value,
        date: document.getElementById('transferDate').value,
        reason: document.getElementById('transferReason').value,
        notes: document.getElementById('transferNotes').value
    };
    
    if (!transferData.to || !transferData.date || !transferData.reason) {
        alert('Please fill in all required fields');
        return;
    }
    
    if (!currentEditingPatient) return;
    
    // Update patient data
    const patientIndex = originalPatientData.findIndex(p => p.id === currentEditingPatient.id);
    if (patientIndex >= 0) {
        originalPatientData[patientIndex].currentLocation = transferData.to;
        originalPatientData[patientIndex].lastTransfer = transferData.date;
        
        if (!originalPatientData[patientIndex].transferHistory) {
            originalPatientData[patientIndex].transferHistory = [];
        }
        originalPatientData[patientIndex].transferHistory.push(transferData);
        
        // Update filtered data
        const filteredIndex = window.patientData.findIndex(p => p.id === currentEditingPatient.id);
        if (filteredIndex >= 0) {
            window.patientData[filteredIndex] = {...originalPatientData[patientIndex]};
        }
    }
    
    // Update related delegations
    originalDelegationData.forEach(delegation => {
        if (delegation.patientId === currentEditingPatient.id) {
            delegation.currentLocation = transferData.to;
            // Check if assigned nurse is still authorized for new location
            const employee = originalEmployeeData.find(e => e.id === delegation.employeeId);
            if (employee && employee.availableLocations) {
                delegation.locationMatch = employee.availableLocations.includes(transferData.to) ? 'Valid' : 'Mismatch';
                delegation.complianceStatus = delegation.locationMatch === 'Valid' ? 'Compliant' : 'Non-Compliant';
            }
        }
    });
    
    dataManager.saveData();
    renderPatientTracking();
    closeTransferModal();
    dataManager.showSaveNotification();
}

function closeTransferModal() {
    document.getElementById('transferHistoryModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    currentEditingPatient = null;
}

// Update existing functions to use enhanced modals
function addNewEmployee() {
    openEmployeeModal();
}

function addNewPatient() {
    openPatientModal();
}

function addNewDelegation() {
    openEnhancedDelegationModal();
}

function editDelegation(id) {
    openEnhancedDelegationModal(id);
}

function recordTransfer() {
    if (window.patientData.length === 0) {
        alert('No patients available for transfer');
        return;
    }
    
    // Show list of patients to select for transfer
    const patientId = prompt('Enter Patient ID to record transfer:');
    if (patientId) {
        const patient = originalPatientData.find(p => p.id === patientId);
        if (patient) {
            openTransferHistoryModal(patientId);
        } else {
            alert('Patient not found');
        }
    }
}

// Enhanced render functions with action buttons
function renderEmployeeProfiles() {
    const tbody = document.getElementById('employeeTableBody');
    tbody.innerHTML = '';
    
    window.employeeData.forEach(employee => {
        const tr = document.createElement('tr');
        
        const certificationBadges = employee.certifications.map(cert => 
            `<span class="badge badge-${cert.status === 'valid' ? 'success' : cert.status === 'expiring' ? 'warning' : 'danger'}">${cert.name} (${cert.expiry})</span>`
        ).join(' ');
        
        const locationBadges = employee.availableLocations.map(loc => 
            `<span class="badge badge-info">${loc}</span>`
        ).join(' ');
        
        tr.innerHTML = `
            <td>${employee.id}</td>
            <td><strong>${employee.name}</strong></td>
            <td>${employee.primaryLocation}</td>
            <td>${locationBadges}</td>
            <td>${employee.authorizedTasks.join(', ')}</td>
            <td>${certificationBadges}</td>
            <td><span class="badge badge-${employee.status === 'Active' ? 'success' : 'warning'}">${employee.status}</span></td>
            <td>${employee.lastUpdated}</td>
            <td class="action-buttons">
                <button class="action-btn edit-btn" onclick="openEmployeeModal('${employee.id}')" title="Edit Employee">✏️</button>
            </td>
        `;
        
        tbody.appendChild(tr);
    });
}

function renderPatientTracking() {
    const tbody = document.getElementById('patientTableBody');
    tbody.innerHTML = '';
    
    window.patientData.forEach(patient => {
        const tr = document.createElement('tr');
        
        tr.innerHTML = `
            <td>${patient.id}</td>
            <td><strong>${patient.name}</strong></td>
            <td>${patient.currentLocation}</td>
            <td>${patient.room}</td>
            <td>${patient.admissionDate}</td>
            <td>${patient.lastTransfer || 'N/A'}</td>
            <td><span class="badge badge-info">${patient.careLevel}</span></td>
            <td>${patient.activeTasks}</td>
            <td><span class="badge badge-${patient.status === 'Current Resident' ? 'success' : 'warning'}">${patient.status}</span></td>
            <td class="action-buttons">
                <button class="action-btn edit-btn" onclick="openPatientModal('${patient.id}')" title="Edit Patient">✏️</button>
                <button class="action-btn status-btn" onclick="openTransferHistoryModal('${patient.id}')" title="Transfer History">📍</button>
            </td>
        `;
        
        tbody.appendChild(tr);
    });
}

function renderDelegationEntry() {
    const tbody = document.getElementById('delegationTableBody');
    tbody.innerHTML = '';
    
    window.delegationData.forEach(delegation => {
        const tr = document.createElement('tr');
        tr.className = getStatusClass(delegation.status);
        
        tr.innerHTML = `
            <td><span class="badge badge-${delegation.status.toLowerCase().replace(' ', '-')}">${delegation.status}</span></td>
            <td>${delegation.patientName} (${delegation.patientId})</td>
            <td>${delegation.currentLocation}</td>
            <td>${delegation.task}</td>
            <td>${delegation.assignedNurse}</td>
            <td><span class="badge badge-${delegation.qualificationCheck === 'Valid' ? 'success' : delegation.qualificationCheck === 'Expiring Soon' ? 'warning' : 'danger'}">${delegation.qualificationCheck}</span></td>
            <td>${delegation.date}</td>
            <td>${delegation.shift}</td>
            <td>${delegation.priority}</td>
            <td><span class="badge badge-${delegation.complianceStatus === 'Compliant' ? 'success' : delegation.complianceStatus === 'At Risk' ? 'warning' : 'danger'}">${delegation.complianceStatus}</span></td>
            <td class="action-buttons">
                <button class="action-btn edit-btn" onclick="editDelegation('${delegation.id}')" title="Edit Delegation">✏️</button>
                <button class="action-btn status-btn" onclick="quickStatusUpdate('${delegation.id}')" title="Quick Status Update">⚡</button>
            </td>
        `;
        
        tbody.appendChild(tr);
    });
}

// Quick status update function
function quickStatusUpdate(delegationId) {
    const delegation = originalDelegationData.find(d => d.id === delegationId);
    if (!delegation) return;
    
    const newStatus = prompt(`Current status: ${delegation.status}\n\nEnter new status:\n- Pending\n- In Progress\n- Completed\n- Overdue\n- Reassigned\n- Cancelled`, delegation.status);
    
    if (newStatus && ['Pending', 'In Progress', 'Completed', 'Overdue', 'Reassigned', 'Cancelled'].includes(newStatus)) {
        const index = originalDelegationData.findIndex(d => d.id === delegationId);
        if (index >= 0) {
            originalDelegationData[index].status = newStatus;
            originalDelegationData[index].lastUpdated = new Date().toISOString();
            
            // Update filtered data
            const filteredIndex = window.delegationData.findIndex(d => d.id === delegationId);
            if (filteredIndex >= 0) {
                window.delegationData[filteredIndex].status = newStatus;
                window.delegationData[filteredIndex].lastUpdated = new Date().toISOString();
            }
        }
        
        dataManager.saveData();
        renderDelegationEntry();
        dataManager.showSaveNotification();
    }
}
    </script>
</body>
</html>
